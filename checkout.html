<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
  <title>עגלה ותשלום — SOLUTION</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  
<nav class="nav">
  <div class="nav-inner container">
    <div class="logo">
      <a href="index.html"><img src="assets/logo.jpg" alt="SOLUTION"></a>
      <span class="badge">פתרונות לשטח • ללא הרשמה</span>
    </div>
    <div class="menu" role="navigation" aria-label="ראשי">
      <a href="catalog.html">קטלוג</a>
      <a href="checkout.html">תשלום</a>
      <a href="#contacts">יצירת קשר</a>
    </div>
    <div class="actions">
      <a class="badge" href="checkout.html">עגלה: <span data-cart-count>0</span></a>
    </div>
  </div>
</nav>

  <main class="container section">
    <h1 style="margin:0 0 12px">עגלה</h1>
    <div style="overflow:auto">
      <table class="table">
        <thead><tr><th>תמונה</th><th>פריט</th><th>מחיר</th><th>כמות</th><th>פעולות</th></tr></thead>
        <tbody data-cart-table></tbody>
      </table>
    </div>
    <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
      <div class="meta">סיכום לתשלום:</div>
      <div class="price" data-total>0 ₪</div>
    </div>
    <hr style="border-color:#1f2937;margin:20px 0">

    <h2 style="margin:0 0 12px">תשלום</h2>
    <p class="meta">אם אין לחצן PayPal, צריך להכניס Client ID בקובץ <code>config/site.json</code> (או דרך /admin).</p>
    <div id="paypal-button-container" style="margin:12px 0"></div>

    <h3 style="margin:16px 0 8px">תשלום (דמו)</h3>
    <form data-ck-form style="display:grid;gap:12px;max-width:560px">
      <input required class="input" placeholder="שם מלא">
      <input required class="input" type="email" placeholder="דוא״ל">
      <input required class="input" type="tel" placeholder="טלפון">
      <input required class="input" placeholder="כתובת משלוח">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div class="meta">לתשלום: <strong data-ck-total>0 ₪</strong></div>
        <button class="btn" type="submit">לתשלום (דמו)</button>
      </div>
      <div class="meta">זהו דמו. לתשלום אמיתי השתמשי ב-PayPal למעלה או נחבר Tranzila/Pelecard.</div>
      <div class="vat">המחירים אינם כוללים מע״מ.</div>
    </form>
    <ul data-checkout-items style="margin-top:12px;list-style:none;padding:0"></ul>
  </main>
  
<footer class="footer" id="contacts">
  <div class="footer-inner container">
    <div>
      <div style="font-weight:700;margin-bottom:8px">SOLUTION</div>
      <div class="meta">מצלמות, בטיחות וציוד שטח חכם.</div>
      <div class="vat">המחירים אינם כוללים מע״מ.</div>
    </div>
    <div>
      <div style="margin-bottom:6px">צור קשר</div>
      <div>WhatsApp: <a href="https://wa.me/972548099815" target="_blank" rel="noreferrer">054-809-9815</a></div>
      <div>טלפון: <a href="tel:+972548099815">054-809-9815</a></div>
      <div>דוא״ל: <a href="mailto:solution7.office@gmail.com">solution7.office@gmail.com</a></div>
    </div>
  </div>
</footer>
<script src="app.js"></script>

  <script>
  async function setupPayPal(){
    try {
      const conf = await fetch('config/site.json', {cache:'no-store'}).then(r=>r.json());
      const cid = conf && conf.paypal_client_id; if(!cid) return;
      const s = document.createElement('script');
      s.src = 'https://www.paypal.com/sdk/js?client-id=' + encodeURIComponent(cid) + '&currency=ILS';
      s.onload = () => renderPayPal();
      document.head.appendChild(s);
    } catch(e) { }
  }
  function renderPayPal(){
    if(!window.paypal) return;
    paypal.Buttons({
      createOrder: (data, actions) => {
        const total = calcCartSummary().total.toFixed(2);
        return actions.order.create({ purchase_units: [{ amount: { value: total, currency_code: 'ILS' }, description: 'SOLUTION order' }] });
      },
      onApprove: async (data, actions) => {
        try { await actions.order.capture(); } catch(e) { }
        alert('תשלום הושלם! תודה רבה.');
        writeCart([]); location.href='index.html';
      },
      onError: (err) => alert('שגיאה בתשלום: ' + err)
    }).render('#paypal-button-container');
  }
  document.addEventListener('DOMContentLoaded', setupPayPal);
  </script>
</body>
</html>
